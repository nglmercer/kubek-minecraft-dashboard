<link rel="stylesheet" href="/pages/serverSettings.css" />

<div class="ssettings-container animate__animated animate__fadeIn animate__faster h-full" style="overflow: auto;">
  <!-- Заголовок -->
  <h2>{{sections.serverSettings}}</h2>
  <!-- Табы -->
  <div class="radioButtons">
    <div class="item active">{{serverSettings.generalSettings}}</div>
  </div>
  <!-- Настройки -->
  <div class="tableWrapper">
    <table>
      <tr>
        <td>
          {{serverSettings.startScript}}
        </td>
        <td>
          <custom-input
          type="text"
          id="start-script"
          name="start-script"
          value="start.sh"
          ></custom-input>
        </td>
      </tr>
      <tr>
        <td>
          {{serverSettings.restartOnError}}
        </td>
        <td>

          <custom-input
          type="boolean"
          id="restart-on-error"
          name="restart-on-error"
          value="true"
          ></custom-input>
        </td>
      </tr>
      <tr id="restart-attempts-tr">
        <td>
          {{serverSettings.restartAttempts}}
        </td>
        <td>
          <custom-input
          type="number"
          id="restart-attempts"
          name="restart-attempts"
          value="3"
          ></custom-input>
        </td>
      </tr>
      <tr>
        <td>
          {{serverSettings.stopCommand}}
        </td>
        <td>
          <custom-input
          type="text"
          id="stop-command"
          name="stop-command"
          value="stop"
          ></custom-input>
        </td>
      </tr>
      <tr>
        <td>
          {{serverSettings.deleteServer}}
        </td>
        <td>
          <button class="danger-btn" id="deleteServerBtn" >{{commons.delete}}</button>
        </td>
      </tr>
    </table>
  </div>

  <!-- Кнопка сохранения -->
  <button class="primary-btn" onclick="KubekServerSettingsUI.writeSettings()">{{commons.save}}</button>
  <dialog-container id="deletedialog" >
    <custom-dialog 
    title="nombre del servidor" 
    description="desea borrar este servidor"
    theme="dark">
  </custom-dialog>
  </dialog-container>
  <script>
    async function getelementStore(element) {
      try {
        const result = await localStorage.getItem(element);
        return JSON.parse(result);
        console.log("element", element,JSON.parse(result));
      } catch (error) {
        return false;
      }
      return JSON.parse(localStorage.getItem(element));
    }
    async function getTranslatestore(lang = "en") {
      let objfind = [];
      const datarray = await getelementStore("rawlanguages");
      console.log("datarray", datarray, lang);
      if (!datarray) return [];
      for (const [key, value] of Object.entries(datarray)) {
        if (value.translations && value.info){
          console.log("value.translations", value,lang);
          if (value.info.code === lang){
            objfind = value.translations;
            break;
          }
        }
      }
      if (objfind.length <= 0 && datarray.length > 0) {
        objfind = datarray[0].translations;
      }
      return objfind;
    }
    var deleteServerDialog = document.querySelector('#deletedialog');
    var deleteServerBtn = document.querySelector('#deleteServerBtn');

    deleteServerBtn.addEventListener('click', ()=>deleteServerDialog.show());
    async function translatedialog(){
      const translations = await getTranslatestore(localStorage.getItem("userlang"));
      console.log("translations", translations["serverSettings"]);
      const dialogcontent = document.querySelector('custom-dialog');
      dialogcontent._title = localStorage.getItem("selectedServer");
      dialogcontent._description = translations["serverSettings"].deleteServer;
      dialogcontent.options = [
        {
          label: translations.commons.delete,
          callback: () => {
            deleteServerDialog.hide();
            //KubekRequests.delete("/servers/" + selectedServer, () => {});
          }
        },
        {
          label: translations.commons.cancel,
          callback: () => {
            deleteServerDialog.hide();
          }
        }
        
      ];
    }
    translatedialog();
  </script>
</div>