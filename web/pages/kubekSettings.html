<link rel="stylesheet" href="/pages/kubekSettings.css"/>

<div class="ksettings-container animate__animated animate__fadeIn animate__faster h-full" style="overflow: auto;">
    <!-- Заголовок -->
    <h2>{{sections.kubekSettings}}</h2>
    <!-- Основные настройки -->
    <div class="tablesWrapper">
        <h4>{{serverSettings.generalSettings}}</h4>
        <table>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded">translate</span>
                        </div>
                        {{kubekSettings.language}}
                    </div>
                </td>
                <td>
                    <div class="checksList" id="language-list">
                        <language-selector selected="en"></language-selector>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded">wifi</span>
                        </div>
                        {{kubekSettings.port}}
                    </div>
                </td>
                <td>
                    <custom-input
                    type="number"
                    id="server-port-input"
                    name="server-port-input"
                    value="3000"
                    placeholder="3000"
                    ></custom-input>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded">router</span>
                        </div>
                        {{kubekSettings.allowAccessOnlyFromIPsList}}
                    </div>
                </td>
                <td>
                    <custom-input
                    type="switch"
                    id="ips-access-switch"
                    name="ips-access-switch"
                    value="true"
                    ></custom-input>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded">router</span>
                        </div>
                        {{kubekSettings.subnetsList}}
                    </div>
                </td>
                <td>
<custom-input
type="textarea"
id="subnets-list"
name="subnets-list"
value="10.0.0.0/8 
172.16.0.0/12"
></custom-input>
                </td>
            </tr>
        </table>
        <!-- Настройки FTP -->
        <h4>{{kubekSettings.ftpSettings}}</h4>
        <table>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded developed-by-seeeroy">cloud</span>
                        </div>
                        {{kubekSettings.ftpEnabled}}
                    </div>
                </td>
                <td>
                    <custom-input
                    type="switch"
                    id="ftp-server-enabled"
                    name="ftp-server-enabled"
                    value="true"
                    ></custom-input>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded">login</span>
                        </div>
                        {{commons.login}}
                    </div>
                </td>
                <td>
                    <custom-input
                    type="text"
                    id="ftp-login-input"
                    name="ftp-login-input"
                    value="kubek"
                    ></custom-input>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded">password</span>
                        </div>
                        {{commons.password}}
                    </div>
                </td>
                <td>
                    <custom-input
                    type="password"
                    id="ftp-password-input"
                    name="ftp-password-input"
                    value="kubek"
                    ></custom-input>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded developed-by-seeeroy">wifi_tethering</span>
                        </div>
                        {{commons.port}}
                    </div>
                </td>
                <td>
                    <custom-input
                    type="number"
                    id="ftp-port-input"
                    name="ftp-port-input"
                    value="21"
                    ></custom-input>
                </td>
            </tr>
        </table>
        <!-- Настройки авторизации -->
        <h4>{{kubekSettings.authSettings}}</h4>
        <table>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded">password</span>
                        </div>
                        {{kubekSettings.authEnabled}}
                    </div>
                </td>
                <td>
                    <custom-input
                    type="switch"
                    id="auth-enabled"
                    name="auth-enabled"
                    value="true"                    
                    ></custom-input>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="flexWrapper">
                        <div class="iconBg">
                            <span class="material-symbols-rounded">groups</span>
                        </div>
                        {{kubekSettings.usersList}}
                    </div>
                </td>
                <td>
                    <div class="checksList" id="accounts-list">

                    </div>
                </td>
            </tr>
        </table>

        <div class="footer">
            <img alt="Kubek icon" class="icon" src="/assets/kubek_icon.png">
            <h2 class="title">Kubek</h2>
            <h4 class="version" id="kubek-version"></h4>
            <h4 class="developer">Designed and developed by <a href="https://github.com/Seeroy">Seeroy</a></h4>
        </div>
    </div>

    <!-- Кнопка сохранения -->
    <button class="primary-btn" onclick="KubekSettingsUI.saveConfig()">{{commons.save}}</button>
</div>

<!-- Modal создания/редактирования пользователя -->
<div class="userEditModal" style="display: none">
    <h2>{{kubekSettings.userEditor}}</h2>
    <!-- Header -->
    <div class="header">
        <div class="avatar">
            <span class="material-symbols-rounded">person</span>
        </div>
        <input type="text" class="username" id="username-input" placeholder="{{kubekSettings.enterUsername}}">
        <input type="email" class="email" id="email-input" placeholder="{{kubekSettings.enterEmail}}">
    </div>
    <!-- Настройка прав -->
    <h3>{{kubekSettings.permissionsList}}</h3>
    <div class="permissions">
        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-file_manager"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.file_manager}}</span>
        </div>

        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-manage_servers"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.manage_servers}}</span>
        </div>

        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-making_servers"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.making_servers}}</span>
        </div>

        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-monitor_servers"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.monitor_servers}}</span>
        </div>

        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-manage_java"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.manage_java}}</span>
        </div>

        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-manage_plugins"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.manage_plugins}}</span>
        </div>

        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-system_monitoring"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.system_monitoring}}</span>
        </div>

        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-kubek_settings"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.kubek_settings}}</span>
        </div>

        <div style="display: flex; align-items: center">
            <label class="switch"
            ><input type="checkbox" id="perm-accounts"/><span
                    class="slider round"
            ></span></label
            ><span style="margin-left: 8px">{{permissions.accounts}} (!)</span>
        </div>
    </div>

    <!-- Ограничение серверов -->
    <div class="restrictServersHeader">
        <h3>{{kubekSettings.restrictServersAccess}}</h3>
        <label class="switch">
            <input type="checkbox" id="restrict-servers-access">
            <span class="slider round"></span>
        </label>
    </div>
    <div class="checksList" id="allowed-servers-list"></div>

    <!-- Поле ввода для пароля -->
    <input type="password" id="password-input" placeholder="{{kubekSettings.enterPassword}}">
    <span id="password-rules">{{kubekSettings.passwordRules}}</span>

    <!-- Ссылка для удаления аккаунта -->
    <div class="hideOnNewAccount" id="delete-account-btn">{{kubekSettings.deleteAccount}}</div>

    <!-- Кнопка сохранения -->
    <div class="footer">
        <button class="primary-btn" id="save-btn" onclick="KubekSettingsUI.saveUser()">{{commons.save}}</button>
        <button class="dark-btn" onclick="KubekSettingsUI.hideUserEditor()">{{commons.cancel}}</button>
    </div>
</div>
<!-- newModalwebcomponent -->
<dialog-container id="deletedialog" >
    <h2 id="kubekSettings.userEditor"> {{kubekSettings.userEditor}} </h2>
    <div class="headertemplate">
        <div class="avatar">
            <span class="material-symbols-rounded">person</span>
        </div>
        <custom-input
        type="text"
        id="login-username"
        name="login"
        placeholder="coloque aqui el nombre de usuario"
        class="username"
        style="padding: 0;"
        >
        </custom-input>
        <custom-input
        type="email"
        id="login-email"
        name="email"
        placeholder="correo electronico"
        class="email"
        style="padding: 0;"

        >
        </custom-input>
    </div>

<!-- Con texto personalizado para el botón -->
    <dropdown-component>
        <h3>{{kubekSettings.permissionsList}}</h3>
    <div class="row">
        <custom-input
        type="switch"
        id="file_manager"
        name="file_manager"
        value="false"
        ></custom-input>
        <translation-span id="file_manager_span" lang="en">{{permissions.file_manager}}</translation-span>
    </div>
    <div class="row">
        <custom-input
        type="switch"
        id="manage_servers"
        name="manage_servers"
        value="false"
        ></custom-input>
        <translation-span id="manage_servers_span" lang="en">{{permissions.manage_servers}}</translation-span>
    </div>
    <div class="row">
        <custom-input
        type="switch"
        id="making_servers"
        name="making_servers"
        value="false"
        ></custom-input>
        <translation-span id="making_servers_span" lang="en">{{permissions.making_servers}}</translation-span>
    </div>
    <div class="row">
        <custom-input
        type="switch"
        id="monitor_servers"
        name="monitor_servers"
        value="false"
        ></custom-input>
        <translation-span id="monitor_servers_span" lang="en">{{permissions.monitor_servers}}</translation-span>
    </div>
    <div class="row">
        <custom-input
        type="switch"
        id="manage_java"
        name="manage_java"
        value="false"
        ></custom-input>
        <translation-span id="manage_java_span" lang="en">{{permissions.manage_java}}</translation-span>
    </div>
    <div class="row">
        <custom-input
        type="switch"
        id="manage_plugins"
        name="manage_plugins"
        value="false"
        ></custom-input>        
        <translation-span id="manage_plugins_span" lang="en">{{permissions.manage_plugins}}</translation-span>
    </div>
    <div class="row">
        <custom-input
        type="switch"
        id="system_monitoring"
        name="system_monitoring"
        value="false"
        ></custom-input>
        <translation-span id="system_monitoring_span" lang="en">{{permissions.system_monitoring}}</translation-span>
    </div>
    <div class="row">
        <custom-input
        type="switch"
        id="kubek_settings"
        name="kubek_settings"
        value="false"
        ></custom-input>
        <translation-span id="kubek_settings_span" lang="en">{{permissions.kubek_settings}}</translation-span>
    </div>
    <div class="row">
        <custom-input
        type="switch"
        id="accounts"
        name="accounts"
        value="false"
        ></custom-input>
        <translation-span id="accounts_span" lang="en">{{permissions.accounts}}</translation-span>
    </div>

    </div>
    </dropdown-component>
    <translation-span id="kubekSettings.passwordRules" lang="en">{{kubekSettings.passwordRules}}</translation-span>
    <custom-input
    type="password"
    id="password-input"
    name="password"
    placeholder="coloque aqui la contraseña"
    >
    </custom-input>
    <custom-dialog
    style="border: 0px solid red;"
    title="añadir nuevo usuario"
    description="desea añadir un nuevo usuario"
    theme="dark">
  </custom-dialog>
  </dialog-container>
<script>
    const deleteServerDialog = document.querySelector('#deletedialog');
    deleteServerDialog.show();
    const dropdown_component = document.querySelector('dropdown-component');
    dropdown_component.toggleDropdown();
    const allelements = document.querySelectorAll('translation-span');
    async function getparsedtranslations(element,subelement, lang = "en") {	
        const translationsraw = await localStorage.getItem("rawlanguages");
        let alltranslations = [];
        for (const [key, value] of Object.entries(JSON.parse(translationsraw))) {
            console.log("key", key, value);
            const langmaped = {
                lang: value.info.code,
                code: value.info.code,
                id: value.info.id,
                translation: value.translations
                
            }
            alltranslations.push(langmaped);
        }
        console.log("alltranslations", alltranslations);
        if (!element && !subelement || !element) return alltranslations;
        if (!subelement && element) return alltranslations.find(item => item.lang === lang).translation[element];
        if (subelement && element) {
            if (alltranslations.find(item => item.lang === lang).translation[element]) {
                return alltranslations.find(item => item.lang === lang).translation[element][subelement];
            } else {
                return alltranslations.find(item => item.lang === lang).translation[element];
            }
        }
    }
    (async () => {
        console.log("getparsedtranslations();", await getparsedtranslations("kubekSettings","userEditor", "es"));
    })();
    const custom_dialog = document.querySelector('custom-dialog');
    custom_dialog.options = [
        {
            label: "{{commons.save}}",
            callback: () => {
                console.log("save");
            }
        },
        {
            label: "{{commons.cancel}}",
            callback: () => {
                console.log("cancel");
            }
        },
    ];
</script>