<!DOCTYPE html>

<head>
    <!-- Meta -->
    <meta charset="utf-8"/>
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Kubek</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/globals.css"/>
    <link rel="stylesheet" href="css/animate.min.css"/>
    <link rel="stylesheet" href="css/atom-one-dark.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <!-- Elements styles -->
    <link rel="stylesheet" href="css/elements/elements.css"/>

    <link rel="stylesheet" href="css/preloader.css"/>
    <link rel="stylesheet" href="css/mobile.css"/>
    <link rel="stylesheet" href="css/theme.css"/>

    <link rel="stylesheet" href="assets/fonts/Gilroy/stylesheet.css"/>
    <link rel="stylesheet" href="assets/fonts/RobotoMono/stylesheet.css"/>
    <link rel="stylesheet" href="assets/fonts/MSR/stylesheet.css"/>
    <script src="js/classes/KubekFileManager.js"></script>

    <script src="js/classes/KubekRequests.js"></script>
    <script src="js/classes/KubekNotifyModal.js"></script>
    <!-- Scripts -->
     <script src="js/utils.js"></script>
     <script src="js/webcomponents.js"></script>
     <script src="js/navwebcomponent.js"></script>
     <script src="js/task.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="js/base64.min.js"></script>
    <script src="js/highlight.min.js"></script>
    <script src="js/mineParse.js"></script>
    <script src="js/ANSIParse.js"></script>
    <script src="js/modalcomponents.js"></script>

    <!-- Classes -->
    <script src="js/classes/KubekPredefined.js"></script>
    <script src="/sections/sidebar.js"></script>
    <script src="js/classes/KubekUI.js"></script>
    <script type="module" src="/initialize.js"></script>

</head>

<body class="scheme-dark-light">
    <template id="mod-card-template">
        <div class="bg-gray-800 rounded-lg p-4 hover:bg-gray-700 transition-colors cursor-pointer">
          <div class="flex items-center gap-4">
            <img class="w-16 h-16 rounded-lg object-cover" src="" alt="Mod icon">
            <div>
              <h3 class="text-xl font-bold"></h3>
              <p class="text-gray-400 line-clamp-2"></p>
            </div>
          </div>
        </div>
      </template>
    
      <template id="mod-details-template">
        <div class="max-w-4xl mx-auto">
          <button class="mb-4 text-blue-500 hover:text-blue-400 btnbase-rounded" id="back-button">← Back to results</button>
          <div class="bg-gray-800 rounded-lg p-6">
            <div class="flex items-start gap-6">
              <img class="w-32 h-32 rounded-lg object-cover" src="" alt="Mod icon">
              <div class="flex-1">
                <h1 class="text-3xl font-bold mb-2"></h1>
                <div class="flex gap-4 mb-4">
                  <span class="bg-gray-700 px-3 py-1 rounded-full text-sm"></span>
                  <span class="bg-gray-700 px-3 py-1 rounded-full text-sm"></span>
                </div>
                <p class="text-gray-300 mb-6"></p>
                <div class="flex gap-4 mb-6">
                  <select class="bg-gray-700 px-4 py-2 rounded texte" id="version-filter">
                    <option value="">All Versions</option>
                  </select>
                  <select class="bg-gray-700 px-4 py-2 rounded" id="loader-filter">
                    <option value="">All Loaders</option>
                  </select>
                </div>
                <div class="space-y-2 max-h-70dvh overflow-y-auto" id="versions-list"></div>
              </div>
            </div>
          </div>
        </div>
      </template>
    <div class="blurScreen" style="display: none; position: fixed;"></div>

    <dialog-container
     id="Eula_dialog_container" 
     required="true"
    >
        <custom-dialog id="Eula_dialog" 
        title=""
        description="{{commons.eula}}"
        style=" max-width: 500px; color: white;"
        theme="dark"
        >
        </custom-dialog>
    </dialog-container>
    <dialog-container id="globaldialog" style="border-radius: 16px;">
        <custom-dialog id="globalmodal_content" style="background-color: #151e27; border-radius: 16px;"
        title="nombre del servidor" 
        description="desea borrar este servidor"
        theme="dark">
    </custom-dialog>
    </dialog-container>
    <sidebar-menu style="font-family: material-symbols-outlined"></sidebar-menu>
    <form id="server-icon-form" enctype="multipart/form-data" style="display: none;">
    <input
            name="server-icon-input"
            id="server-icon-input"
            class="superHide"
            type="file"
            accept="image/png, image/jpeg"
    />
</form>

<div class="content-header">
    <div class="icon-bg" onclick="uploadServerIcon()">
        <img src="" alt="Server icon"/>
        <span class="material-symbols-rounded" style="display: none">upload</span>
    </div>
    <div class="caption"></div>
    <status-element status="STOPPED"></status-element>
    <div class="actions">
        <action-buttons></action-buttons>
        <script>
            const actionButtons = document.querySelector('action-buttons');
            actionButtons.addButton({
                id: 'start-server',
                label: '{{commons.start}}',
                icon: 'play_arrow',
                action: 'start-server'
            });
            actionButtons.addButton({
                id: 'stop-server',
                label: '{{commons.stop}}',
                icon: 'stop',
                action: 'stop-server'
            });
            actionButtons.addButton({
                id: 'restart-server',
                label: '{{commons.restart}}',
                icon: 'restart_alt',
                iconOnly: true,
                action: 'restart-server'
            });
            actionButtons.addButton({
                id: 'more-server-actions',
                label: '{{commons.more}}',
                icon: 'more_horiz',
                iconOnly: true,
                action: 'more-server-actions'   
            });
            actionButtons.hideButton('more-server-actions');
            actionButtons.hideButton('kill-server');
            actionButtons.hideButton('restart-server');
            actionButtons.hideButton('stop-server');
            actionButtons.addEventListener('button-clicked', (e) => {
                console.log("button-clicked", e);
                const {action, id} = e.detail;
                if (action === 'start-server') {
                    KubekServers.startServer(window.localStorage.selectedServer);
                } else if (action === 'stop-server') {
                    KubekServers.stopServer(window.localStorage.selectedServer);
                } else if (action === 'restart-server') {
                    KubekServers.restartServer(window.localStorage.selectedServer);
                } else if (action === "more-server-actions") {
                    showServerPopup(e);
                }

            });
            let initpopup = false;
            function showServerPopup(e) {
                const popupElement = document.querySelector('#server-popup');
                const buttonElement = e.target;

                popupElement.showAtElement(buttonElement);
                if (!initpopup) initPoup(popupElement);
                initpopup = true;
            }
            function initPoup(popupElement) {
                const hoverStyles = `
                    <style>
                        .dropdown-item {
                            background: var(--bg-dark-accent);
                            border-radius: 8px;
                            padding: 4px 8px;
                            display: flex;
                            flex-direction: row;
                            align-items: center;
                            cursor: pointer;
                            height: 48px;
                            font-size: 12pt;
                            width: 100%;
                        }
                        .dropdown-item:hover {
                            background: #2e3e53;
                        }
                    </style>
                `;

                // Add force quit button to popup
                popupElement.addOption(
                    `${hoverStyles}<div class="dropdown-item">
                        <span class="material-symbols-rounded">dangerous</span>
                        <span class="default-font">Force Quit</span>
                    </div>`,
                    () => {
                        popupElement.hide();
                        if (currentServerStatus !== KubekPredefined.SERVER_STATUSES.STOPPED) {
                            KubekRequests.get(`/servers/${selectedServer}/kill`);
                        }
                    }
                );
            }
        </script>
    </div>
</div>
<custom-popup id="server-popup" class="material-symbols-rounded">
  </custom-popup>
<style>
     .content-header {
        grid-area: content-header;
        padding: 6px 8px 14px 8px;
        width: 100%;
        height: max-content;

        display: grid;
        grid-template-columns: 64px 1fr max-content;
        grid-template-rows: 1fr 1fr;
        gap: 0em 1.6em;
        grid-template-areas:
      "icon-bg caption actions"
      "icon-bg status actions";
    }

     .content-header .icon-bg {
        grid-area: icon-bg;

        width: 64px;
        height: 64px;
        border-radius: 9999px;
        background: var(--bg-dark-accent);
        display: flex;
        align-items: center;
        justify-content: center;
    }

     .content-header .icon-bg img {
        height: 36px;
    }

     .content-header .caption {
        grid-area: caption;

        font-size: 18pt;
        font-weight: 700;
    }

     .content-header .actions {
        grid-area: actions;
        justify-self: center;
        align-self: center;

        display: flex;
        align-items: center;
        justify-content: center;
    }

     .content-header .actions button {
        margin: 0 6px;
        border-radius: 12px;
    }

    /* Content header status styling */
     .content-header .status {
        grid-area: status;

        display: flex;
        align-items: center;
    }

     .content-header .status .circle {
        width: 10px;
        height: 10px;
        border-radius: 9999px;
        background: var(--bg-dark-accent);
    }

     .content-header .status .circle.green {
        background: #0e9f6e;
    }

     .content-header .status .circle.yellow {
        background: #faca15;
    }

     .content-header .status .circle.red {
        background: #e02424;
    }

     .content-header .status .text {
        margin-left: 10px;
        font-size: 11pt;
        font-weight: 300;
    }

     .content-header .icon-bg {
        cursor: pointer;
    }

     .content-header .icon-bg:hover {
        background: var(--bg-dark-accent-light);
    }

     .content-header .icon-bg:hover img {
        display: none;
    }

     .content-header .icon-bg:hover .material-symbols-rounded {
        display: block !important;
    }
</style>
    <nav-bar
        style="position: fixed; top: 0;"
    >
        <div slot="navbar-content" class="flex">
          <div>
            <button type="button" role="button" aria-label="reload window" id="reloadwindow" class="open-modal-btn" onclick="window.location.reload()">⟳
            </button>
          </div>
        </div>
      </nav-bar>
      <side-bar>
        <div slot="sidebar-content">
            <server-menu
            style="color: white;"
            ></server-menu>
        </div>
      </side-bar>
      <main-content>
        <div slot="1-content" class="bg-slate-800 text-white" style="margin-bottom: 32px;">
            <link rel="stylesheet" href="/pages/console.css"/>

        <div class="console-container animate__animated animate__fadeIn animate__fast">
            <!-- Заголовок -->
            <h2>{{sections.console}}</h2>
            <!-- Главный контейнер -->
            <div class="console-layout">
                <!-- Сама консоль -->
                <div class="console" id="asdasd">
                    <game-console></game-console>
                    
                </div>
                <div class="input">
                    <input-command></input-command>

                </div>
                <!-- Доп. блоки -->
                <div class="settings">
                    <!-- Блок мониторинга CPU -->
                    <div class="layout-accent-box">
        <!--                 <div class="lds-spinner flexCentered developed-by-seeeroy" id="cpu-usage-spinner"><div></div><div></div><div></div></div>
        -->                <kubek-circle-progress id="cpu-bar"></kubek-circle-progress>
                        <div class="desc-text">
                            <h4>CPU</h4>
                        </div>
                    </div>
                    <!-- Блок мониторинга RAM -->
                    <div class="layout-accent-box">
        <!--                 <div class="lds-spinner flexCentered" id="ram-usage-spinner"><div></div><div></div><div></div></div>
        -->                <kubek-circle-progress id="ram-bar"></kubek-circle-progress>
                        <div class="desc-text">
                            <h4>RAM</h4>
                            <sup id="ram-usage-text">{{commons.loading}}</sup>
                        </div>
                    </div>
                </div>
            </div>
            <kubek-refresher id="kubekRefresher"></kubek-refresher>

        </div>

        </div>
        <div slot="2-content" class="bg-slate-800 text-white">
        <link rel="stylesheet" href="/pages/fileManager.css"/>

        <form id="g-file-form" enctype="multipart/form-data">
            <input
                    name="g-file-input"
                    id="g-file-input"
                    style="
            position: absolute;
            left: -2582px;
            right: 0;
            top: 0;
            bottom: 0;
            z-index: -285;
            display: none;
            "
                    type="file"
            />
        </form>

        <div class="fileEditor" style="display: none">
            <!-- Header -->
            <div class="header">
                <input type="text" value="testFile" placeholder="{{fileManager.filename}}">
            </div>

            <!-- Код -->
            <pre><code contenteditable="true" id="code-edit"></code></pre>

            <!-- Footer -->
            <div class="footer">
                <button class="primary-btn" onclick="KubekFileManagerUI.writeFile()">{{commons.save}}</button>
                <button class="dark-btn" onclick="KubekFileManagerUI.closeEditor()">{{commons.cancel}}</button>
            </div>
        </div>

        <div class="fm-container animate__animated animate__fadeIn animate__faster">
            <h2 class="title">{{sections.fileManager}}</h2>
            <div class="actions">
                <action-buttons id="fm-actions"></action-buttons>
                <script>

                    const actionfmButtons = document.querySelector('#fm-actions');
                    actionfmButtons.addButton({
                        id: 'new-file',
                        label: '{{commons.create}} {{commons.file.lowerCase}}',
                        icon: 'add_circle',
                        action: 'new-file'
                    });
                    actionfmButtons.addButton({
                        id: 'upload-file',
                        label: '{{commons.uploadFile}}',
                        icon: 'upload_file',
                        action: 'upload-file',
                        iconOnly: true
                    });
                    actionfmButtons.addButton({
                        id: 'new-folder',
                        label: '{{commons.create}} {{commons.folder.lowerCase}}',
                        icon: 'create_new_folder',
                        action: 'new-folder',
                        iconOnly: true
                    });
                    actionfmButtons.addButton({
                        id: 'refresh-folder',
                        label: '{{commons.refresh}}',
                        icon: 'refresh',
                        action: 'refresh-folder',
                        iconOnly: true
                    });
                    actionfmButtons.addEventListener('button-clicked', (e) => {
                        console.log("button-clicked", e);
                        const {action, id} = e.detail;
                        if (action === 'new-file') {
                            KubekFileManagerUI.openEmptyEditor();
                        } else if (action === 'upload-file') {
                            KubekFileManagerUI.uploadFile();
                        } else if (action === 'new-folder') {
                            KubekFileManagerUI.newDirectory();
                        } else if (action === 'refresh-folder') {
                            KubekFileManagerUI.refreshDir();
                        }
                    });
                    document.addEventListener('DOMContentLoaded', () => {
                        KubekFileManagerUI.initaddeventlisteners();
                    KubekFileManagerUI.refreshDir();
                    // Event listener for code editing
                    document.getElementById("code-edit").addEventListener("input", function() {
                        KubekFileManagerUI.formatCode();
                    });
                    });
                </script>
            </div>
            <div class="breadcrumb" id="fm-breadcrumb"></div>
            <div class="table-container table">
                <table id="fm-table">
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <custom-popup id="fm-popup" class="material-symbols-rounded">
        </custom-popup>
        <div id="path-display"></div>
        <file-explorer current-path="./"></file-explorer>
        </div>
        <div slot="3-content" class="bg-slate-800 text-white">
            <link rel="stylesheet" href="/pages/plugins.css"/>

            <!-- Формы для отправки файлов -->
            <form id="server-plugin-form" enctype="multipart/form-data">
                <input
                        name="server-plugin-input"
                        id="server-plugin-input"
                        class="superHide"
                        type="file"
                        accept=".jar"
                />
            </form>

            <form id="server-mod-form" enctype="multipart/form-data">
                <input
                        name="server-mod-input"
                        id="server-mod-input"
                        class="superHide"
                        type="file"
                        accept=".jar"
                />
            </form>

            <!-- Главный контейнер -->
            <div class="plugins-container animate__animated animate__fadeIn animate__faster">
                <!-- Панель с плагинами -->
                <div class="panel">
                    <div class="header">
                        <h2>{{commons.plugins}}</h2>
                        <button class="dark-btn icon-only" onclick="KubekPluginsUI.uploadItem('plugin')">
                            <span class="material-symbols-rounded">upload</span>
                        </button>
                    </div>

                    <div id="plugins-list" class="list"></div>
                    <kubek-plugins-ui id="plugins-ui"></kubek-plugins-ui>

                </div>

                <!-- Панель с модификациями -->
                <div class="panel">
                    <div class="header">
                        <h2>{{commons.mods}}</h2>
                        <button class="dark-btn icon-only" onclick="KubekPluginsUI.uploadItem('mod')">
                            <span class="material-symbols-rounded">upload</span>
                        </button>
                    </div>

                    <div id="mods-list" class="list"></div>
                    <kubek-plugins-ui id="mods-ui"></kubek-plugins-ui>

                </div>
                <div class="panel">
                      <button class="btn-primary" id="mod-search-button" >{{commons.pluginsmodstore}}</button>
                </div>
                <custom-modal id="custom-modal" style="max-height: 100vh; overflow-y: scroll;">
                    <mod-search></mod-search>
                  
                  </custom-modal>
            </div>

        </div>
        <div slot="4-content" class="bg-slate-800 text-white">
            <link rel="stylesheet" href="/pages/serverSettings.css" />

            <div class="ssettings-container animate__animated animate__fadeIn animate__faster h-full" style="overflow: auto;">
            <!-- Заголовок -->
            <h2>{{sections.serverSettings}}</h2>
            <!-- Табы -->
            <div class="radioButtons">
                <div class="item active">{{serverSettings.generalSettings}}</div>
            </div>
            <!-- Настройки -->
            <div class="tableWrapper">
                <table>
                <tr>
                    <td>
                    {{serverSettings.startScript}}
                    </td>
                    <td>
                    <custom-input
                    type="text"
                    id="start-script"
                    name="start-script"
                    value="start.sh"
                    ></custom-input>
                    </td>
                </tr>
                <tr>
                    <td>
                    {{serverSettings.restartOnError}}
                    </td>
                    <td>

                    <custom-input
                    type="boolean"
                    id="restart-on-error"
                    name="restart-on-error"
                    value="true"
                    ></custom-input>
                    </td>
                </tr>
                <tr id="restart-attempts-tr">
                    <td>
                    {{serverSettings.restartAttempts}}
                    </td>
                    <td>
                    <custom-input
                    type="number"
                    id="restart-attempts"
                    name="restart-attempts"
                    value="3"
                    ></custom-input>
                    </td>
                </tr>
                <tr>
                    <td>
                    {{serverSettings.stopCommand}}
                    </td>
                    <td>
                    <custom-input
                    type="text"
                    id="stop-command"
                    name="stop-command"
                    value="stop"
                    ></custom-input>
                    </td>
                </tr>
                <tr>
                    <td>
                    {{serverSettings.deleteServer}}
                    </td>
                    <td>
                    <button class="danger-btn" id="deleteServerBtn" >{{commons.delete}}</button>
                    </td>
                </tr>
                </table>
            </div>

            <!-- Кнопка сохранения -->
            <button class="primary-btn" onclick="KubekServerSettingsUI.writeSettings()">{{commons.save}}</button>
            <dialog-container id="deletedialog" style="border-radius: 16px;">
                <custom-dialog id="deletedialog_content" style="background-color: #151e27; border-radius: 16px;"
                title="nombre del servidor" 
                description="desea borrar este servidor"
                theme="dark">
            </custom-dialog>
            </dialog-container>
            </div>
        </div>
        <div slot="5-content" class="bg-slate-800 text-white"  style="margin-bottom: 32px;">
            <link rel="stylesheet" href="/pages/server.properties.css" />

            <div
              class="speditor-container animate__animated animate__fadeIn animate__faster"
            >
              <!-- Заголовок -->
              <h2>Server.properties</h2>
              <!-- Главная таблица -->
              <div class="tableWrapper">
                <server-properties></server-properties>
            
                <table id="sp-table">
            
                </table>
              </div>
              <!-- Кнопка сохранения -->
              <button class="primary-btn" id="save-properties">{{commons.save}}</button>
            </div>
            
        </div>
        <div slot="6-content" class="bg-slate-800 text-white">
            <link rel="stylesheet" href="/pages/kubekSettings.css"/>

            <div class="ksettings-container animate__animated animate__fadeIn animate__faster h-full" style="overflow: auto;">
                <!-- Заголовок -->
                <h2>{{sections.kubekSettings}}</h2>
                <!-- Основные настройки -->
                <div class="tablesWrapper">
                    <h4>{{serverSettings.generalSettings}}</h4>
                    <table>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded">translate</span>
                                    </div>
                                    {{kubekSettings.language}}
                                </div>
                            </td>
                            <td>
                                <div class="checksList" id="language-list">
                                    <language-selector selected="en"></language-selector>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded">wifi</span>
                                    </div>
                                    {{kubekSettings.port}}
                                </div>
                            </td>
                            <td>
                                <custom-input
                                type="number"
                                id="server-port-input"
                                name="server-port-input"
                                value="3000"
                                placeholder="3000"
                                ></custom-input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded">router</span>
                                    </div>
                                    {{kubekSettings.allowAccessOnlyFromIPsList}}
                                </div>
                            </td>
                            <td>
                                <custom-input
                                type="switch"
                                id="ips-access-switch"
                                name="ips-access-switch"
                                value="true"
                                ></custom-input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded">router</span>
                                    </div>
                                    {{kubekSettings.subnetsList}}
                                </div>
                            </td>
                            <td>
            <custom-input
            type="textarea"
            id="subnets-list"
            name="subnets-list"
            value="10.0.0.0/8 
            172.16.0.0/12"
            ></custom-input>
                            </td>
                        </tr>
                    </table>
                    <!-- Настройки FTP -->
                    <h4>{{kubekSettings.ftpSettings}}</h4>
                    <table>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded developed-by-seeeroy">cloud</span>
                                    </div>
                                    {{kubekSettings.ftpEnabled}}
                                </div>
                            </td>
                            <td>
                                <custom-input
                                type="switch"
                                id="ftp-server-enabled"
                                name="ftp-server-enabled"
                                value="true"
                                ></custom-input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded">login</span>
                                    </div>
                                    {{commons.login}}
                                </div>
                            </td>
                            <td>
                                <custom-input
                                type="text"
                                id="ftp-login-input"
                                name="ftp-login-input"
                                value="kubek"
                                ></custom-input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded">password</span>
                                    </div>
                                    {{commons.password}}
                                </div>
                            </td>
                            <td>
                                <custom-input
                                type="password"
                                id="ftp-password-input"
                                name="ftp-password-input"
                                value="kubek"
                                ></custom-input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded developed-by-seeeroy">wifi_tethering</span>
                                    </div>
                                    {{commons.port}}
                                </div>
                            </td>
                            <td>
                                <custom-input
                                type="number"
                                id="ftp-port-input"
                                name="ftp-port-input"
                                value="21"
                                ></custom-input>
                            </td>
                        </tr>
                    </table>
                    <!-- Настройки авторизации -->
                    <h4>{{kubekSettings.authSettings}}</h4>
                    <table>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded">password</span>
                                    </div>
                                    {{kubekSettings.authEnabled}}
                                </div>
                            </td>
                            <td>
                                <custom-input
                                type="switch"
                                id="auth-enabled"
                                name="auth-enabled"
                                value="true"                    
                                ></custom-input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="flexWrapper">
                                    <div class="iconBg">
                                        <span class="material-symbols-rounded">groups</span>
                                    </div>
                                    {{kubekSettings.usersList}}
                                </div>
                            </td>
                            <td>
                                <div class="checksList" id="accounts-list">

                                </div>
                            </td>
                        </tr>
                    </table>

                    <div class="footer">
                        <img alt="Kubek icon" class="icon" src="/assets/kubek_icon.png">
                        <h2 class="title">Kubek</h2>
                        <h4 class="version" id="kubek-version"></h4>
                        <h4 class="developer">{{commons.copyright}} <a href="https://github.com/Seeroy">Seeroy</a></h4>
                    </div>
                </div>

                <!-- Кнопка сохранения -->
                <button class="primary-btn" onclick="KubekSettingsUI.saveConfig()">{{commons.save}}</button>
            </div>

            <!-- Modal создания/редактирования пользователя -->
            <div class="userEditModal" style="display: none">
                <h2>{{kubekSettings.userEditor}}</h2>
                <!-- Header -->
                <div class="header">
                    <div class="avatar">
                        <span class="material-symbols-rounded">person</span>
                    </div>
                    <input type="text" class="username" id="username-input" placeholder="{{kubekSettings.enterUsername}}">
                    <input type="email" class="email" id="email-input" placeholder="{{kubekSettings.enterEmail}}">
                </div>
                <!-- Настройка прав -->
                <h3>{{kubekSettings.permissionsList}}</h3>
                <div class="permissions">
                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-file_manager"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.file_manager}}</span>
                    </div>

                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-manage_servers"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.manage_servers}}</span>
                    </div>

                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-making_servers"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.making_servers}}</span>
                    </div>

                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-monitor_servers"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.monitor_servers}}</span>
                    </div>

                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-manage_java"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.manage_java}}</span>
                    </div>

                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-manage_plugins"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.manage_plugins}}</span>
                    </div>

                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-system_monitoring"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.system_monitoring}}</span>
                    </div>

                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-kubek_settings"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.kubek_settings}}</span>
                    </div>

                    <div style="display: flex; align-items: center">
                        <label class="switch"
                        ><input type="checkbox" id="perm-accounts"/><span
                                class="slider round"
                        ></span></label
                        ><span style="margin-left: 8px">{{permissions.accounts}} (!)</span>
                    </div>
                </div>

                <!-- Ограничение серверов -->
                <div class="restrictServersHeader">
                    <h3>{{kubekSettings.restrictServersAccess}}</h3>
                    <label class="switch">
                        <input type="checkbox" id="restrict-servers-access">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="checksList" id="allowed-servers-list"></div>

                <!-- Поле ввода для пароля -->
                <input type="password" id="password-input" placeholder="{{kubekSettings.enterPassword}}">
                <span id="password-rules">{{kubekSettings.passwordRules}}</span>

                <!-- Ссылка для удаления аккаунта -->
                <div class="hideOnNewAccount" id="delete-account-btn">{{kubekSettings.deleteAccount}}</div>

                <!-- Кнопка сохранения -->
                <div class="footer">
                    <button class="primary-btn" id="save-btn" onclick="KubekSettingsUI.saveUser()">{{commons.save}}</button>
                    <button class="dark-btn" onclick="KubekSettingsUI.hideUserEditor()">{{commons.cancel}}</button>
                </div>
            </div>
            <!-- newModalwebcomponent -->
            <dialog-container id="userModal" style="padding: 4px; margin: 4px;">
                <h2 id="kubekSettings.userEditor"> {{kubekSettings.userEditor}} </h2>
                <form id="verify-form">
                    <div class="headertemplate">
                        <div class="avatar">
                            <span class="material-symbols-rounded">person</span>
                        </div>
                        <custom-input
                        type="text"
                        id="login_username"
                        name="login"
                        placeholder="{{kubekSettings.enterUsername}}"
                        class="username"
                        style="padding: 0; background-color: transparent;"
                        title="{{kubekSettings.enterUsername}}"
                        required
                        >
                        </custom-input>
                        <custom-input
                        type="email"
                        id="login_email"
                        name="email"
                        placeholder="{{kubekSettings.enterEmail}}"
                        class="email"
                        style="padding: 0;"
                
                        >
                        </custom-input>
                    </div>
                
                <!-- Con texto personalizado para el botón -->
                    <dropdown-component style=" border-color: gray; color: rgba(128, 128, 128, 0.4); gap: 0.5rem;">
                        <h3>{{kubekSettings.permissionsList}}</h3>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="file_manager"
                        name="file_manager"
                        value="false"
                        ></custom-input>
                        <span id="file_manager_span" lang="en">{{permissions.file_manager}}</span>
                    </div>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="manage_servers"
                        name="manage_servers"
                        value="false"
                        ></custom-input>
                        <span id="manage_servers_span" lang="en">{{permissions.manage_servers}}</span>
                    </div>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="making_servers"
                        name="making_servers"
                        value="false"
                        ></custom-input>
                        <span id="making_servers_span" lang="en">{{permissions.making_servers}}</span>
                    </div>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="monitor_servers"
                        name="monitor_servers"
                        value="false"
                        ></custom-input>
                        <span id="monitor_servers_span" lang="en">{{permissions.monitor_servers}}</span>
                    </div>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="manage_java"
                        name="manage_java"
                        value="false"
                        ></custom-input>
                        <span id="manage_java_span" lang="en">{{permissions.manage_java}}</span>
                    </div>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="manage_plugins"
                        name="manage_plugins"
                        value="false"
                        ></custom-input>        
                        <span id="manage_plugins_span" lang="en">{{permissions.manage_plugins}}</span>
                    </div>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="system_monitoring"
                        name="system_monitoring"
                        value="false"
                        ></custom-input>
                        <span id="system_monitoring_span" lang="en">{{permissions.system_monitoring}}</span>
                    </div>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="kubek_settings"
                        name="kubek_settings"
                        value="false"
                        ></custom-input>
                        <span id="kubek_settings_span" lang="en">{{permissions.kubek_settings}}</span>
                    </div>
                    <div class="row">
                        <custom-input
                        type="switch"
                        id="accounts"
                        name="accounts"
                        value="false"
                        ></custom-input>
                        <span id="accounts_span" lang="en">{{permissions.accounts}}</span>
                    </div>
                
                    </dropdown-component>
                    <div style="display: flex; flex-direction: row; align-items: center; margin: 12px 0; gap: 0.5rem;">
                        <span id="kubekSettings.passwordRules" lang="en">{{kubekSettings.restrictServersAccess}}</span>
                        <custom-input
                        type="switch"
                        id="isServersRestricted"
                        name="isServersRestricted"
                        value="false"
                        ></custom-input>
                    </div>
                    <dropdown-component id="selected_server_dropdown" style=" border-color: gray; color: rgba(128, 128, 128, 0.4);gap: 0.5rem;">
                        <enhanced-select multiple
                        style="border: 0px;"
                        id="select_servers"
                        name="select_servers"
                        ></enhanced-select>
                    </dropdown-component>
                    <span id="kubekSettings.passwordRules" lang="en">{{kubekSettings.passwordRules}}</span>
                    <custom-input
                    style="border: 2px solid #29292950; border-radius: 4px; padding: 0; margin: 0;"
                    type="password"
                    id="login_password"
                    name="password"
                    placeholder="{{kubekSettings.enterPassword}}"
                    required
                    title="{{kubekSettings.enterPassword}}"
                    pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" 
                    >
                    </custom-input>
                </form>
                <custom-dialog id="userModal_dialog"
                style="border: 0px solid red;"
                theme="dark">
            </custom-dialog>
            </dialog-container>

        </div>
          <div slot="7-content" class="bg-slate-800 text-white">
            <system-monitor></system-monitor>
          </div>
      </main-content>
</body>
<kubek-alerts id="alerts_pool"></kubek-alerts>
<script>
    const Eula_dialog = document.querySelector("#Eula_dialog");
    Eula_dialog.options = [
        {
            label: "{{commons.iAccept}}",
            class: "save-btn",
            callback: () => {
                console.log("accept");
                KubekRequests.get("/kubek/eula/accept", () => {
                    window.location.reload();
                });
            }
        }
        ];	
console.log("[UI] Starting Kubek UI...");
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
let act = urlParams.get("act");
let selectedServer = window.localStorage.selectedServer || "";
let consoleRamUsageBar, consoleCpuUsageBar;

document.addEventListener('DOMContentLoaded', function () { 
    KubekRequests.get("/kubek/settings", (settings) => {
        console.log("settings /kubek/settings",settings);
        if (settings.eulaAccepted === false) {
            document.querySelector("#Eula_dialog_container").show();
        }
    });

    KubekRequests.get("/updates", (update) => {
        if (update.hasUpdate === true) {
            KubekAlerts.addAlert("{{commons.updateAvailable}}", "update", update.version.new, 6000, "colored", () => {
                KubekNotifyModal.create("<h2>{{commons.updateAvailable}}</h2><div style='display: flex; align-items: center; justify-content: center;'>" + update.version.current + " <span class='material-symbols-rounded' style='font-size: 18pt; margin: 0 12px;'>navigate_next</span> " + update.version.new + "</div>", update.body.replaceAll("\n", "<br>"), "{{commons.goto}}", "update", () => {
                    window.open(update.url, "_blank");
                }, KubekPredefined.MODAL_CANCEL_BTN);
            });
        }
    });
    KubekServers.getServersList((servers) => {
        if (!servers && servers !== false && !servers.length) {
            window.location.href = "createserver.html";
            console.log("servers getServersList", servers, "servers.length", servers.length);
            return;
        }
        if (!servers) return;
        console.log("servers getServersList", servers); 
        if (servers.has(window.localStorage.selectedServer)) {
            selectedServer = window.localStorage.selectedServer;
        } else {
            localStorage.setItem("selectedServer", servers[0]);
            selectedServer = servers[0];
        }
    });
    KubekRequests.get("/kubek/rawlanguages", (langs) => {
        localStorage.setItem("rawlanguages", JSON.stringify(langs));
    });
});
function uploadServerIcon() {
    // Obtener el elemento input
    const inputElement = document.getElementById('server-icon-input');
    
    // Simular click en el input para abrir el selector de archivos
    inputElement.click();
    
    // Remover event listeners previos para evitar duplicados
    inputElement.removeEventListener('change', handleFileChange);
    
    // Agregar nuevo event listener
    inputElement.addEventListener('change', handleFileChange);
    
    // Función para manejar el cambio de archivo
    function handleFileChange() {
        // Crear FormData a partir del formulario
        const formElement = document.getElementById('server-icon-form');
        const formData = new FormData(formElement);
        
        // Realizar la petición POST
        KubekRequests.post(`/servers/${selectedServer}/icon`, () => {
            // Recargar la UI después de subir el ícono
            KubekServerHeaderUI.loadServerByName(selectedServer, () => {
                KubekUI.loadServersList();
            });
        }, formData);
    }
}
</script>


<script>
function changeProgressvalue(element, value, action = "setvalue") {
    const cpuElem = document.getElementById("cpu-bar");
    const ramElem = document.getElementById("ram-bar");
    const elements = {
        "cpu": cpuElem,
        "ram": ramElem
    };
    const actions = {
        "setvalue": "value",
        "setactivecolor": "active-color"
    }
    if (typeof elements[element] !== "undefined") {
        if (typeof actions[action] !== "undefined") {
            elements[element].setAttribute(actions[action], value);
        }
    }
}
KubekConsoleUI = class {
    // Обновить progress бары использования рес-ов
    static refreshUsageItems(cpu, ram, ramElem) {
        changeProgressvalue("cpu", cpu);
        changeProgressvalue("ram", ram);
        changeProgressvalue("ram", KubekUtils.getProgressGradientColor(ram), "setactivecolor");
        changeProgressvalue("cpu", KubekUtils.getProgressGradientColor(cpu), "setactivecolor");
        const ramusagecontainer = document.querySelector("#ram-usage-text");
        if (ramusagecontainer) {
            ramusagecontainer.textContent = KubekUtils.humanizeFileSize(ramElem.used) + " / " + KubekUtils.humanizeFileSize(ramElem.total);
        }
    }
}


    var inputCommandelement = document.querySelector('input-command');
    console.log("inputCommandelement", inputCommandelement);
    inputCommandelement.addEventListener('command', (e) => {
        const detail = e.detail;
        console.log("detail",);
        KubekServers.sendCommandToServer(selectedServer, detail.command);
    });

    const server_menu = document.querySelector('server-menu');
    server_menu.addEventListener('server-change', (e) => {
        console.log("server-change", e.detail);
        window.localStorage.selectedServer = event.detail.server;
        window.location.reload();
    });
    server_menu.addEventListener('new-server', (e) => {
        console.log("new-server", e);
        const url = new URL(window.location.href);
        // redirect to new server 
        window.location.href = url.origin + '/createserver.html';
    });
</script>
<script src="pages/fileManager.js"></script>
<script src="pages/serverSettings.js"></script>
<script src="pages/server.properties.js"></script>
<script src="pages/kubekSettings.js"></script>
<script src="pages/plugins.js"></script>
<script>
document.getElementById('mod-search-button').addEventListener('click', () => {
  document.getElementById('custom-modal').open();
});
setTimeout(() => {
    if (!window.localStorage.selectedServer) {
        window.location.href = "createserver.html";
    }
}, 1000);
</script>